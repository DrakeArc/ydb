# CREATE RESOURCE POOL

`CREATE RESOURCE POOL` создаёт [resource pool](../../../../concepts/gloassary#resource-pool).

## Синтаксис

```sql
CREATE RESOURCE POOL <имя>
WITH ( <имя_параметра> [= <значение_параметра>] [, ... ] )
```

### Параметры {#параметры}
* `имя` - имя создаваемого resource pool. Должно быть уникально. Не допускается запись в виде пути (т.е. не должно содержать `/`).
* `WITH ( <имя_параметра> [= <значение_параметра>] [, ... ] )` позволяет задать значения параметров, определяющих поведение resource pool. Поддерживаются следующие опции:
    * `CONCURRENT_QUERY_LIMIT` (Int) - опциональное поле, которое задает число параллельно выполняющихся запросов в resource pool. Если значение -1, то ограничений нет. Допустимые значения: -1, [0, MAX_INT32]
    * `QUEUE_SIZE` (Int) - опциональное поле, которое задает размер очереди ожидания. Всего в системе в один момент времени может находиться не больше чем `CONCURRENT_QUERY_LIMIT + QUEUE_SIZE` запросов. Если значение -1, то ограничений нет. Допустимые значения: -1, [0, MAX_INT32]
    * `DATABASE_LOAD_CPU_THRESHOLD` (Int) - опциональное поле, порог загрузки cpu всей базы данных после которого запросы больше не отправляются на выполнение, а ожидают в очереди. Если значение -1, то ограничений нет. Допустимые значения: -1, [0, 100]
    * `QUERY_MEMORY_LIMIT_PERCENT_PER_NODE` (Double) - опциональное поле, которое задает процент доступной памяти на ноде запросом в этом пуле. Если значение -1, то работает ограничение максимальной доступной памяти на ноде между всеми запросами. Допустимые значения: -1, [0, 100]
    * `TOTAL_CPU_LIMIT_PERCENT_PER_NODE` (Double) - опциональное поле, которое задает процент доступного CPU всеми запросами на ноде в этом пуле. Если значение -1, то ограничений нет. Допустимые значения: -1, [0, 100]
    * `QUERY_CPU_LIMIT_PERCENT_PER_NODE` (Double) - опциональное поле, которое задает процент доступного CPU на запрос в пуле на ноде. Если значение -1, то ограничений нет. Допустимые значения: -1, [0, 100]
    * `RESOURCE_WEIGHT` (Int) - опциональное поле, которое задает веса распределения ресурсов между пулами. Если значение -1, то веса выключены. Допустимые значения: -1, [0, MAX_INT32]

## Замечания {#замечания}

Запросы всегда выполняются в каком-то resource pool. По умолчанию все запросы отправляются в `default` resource pool, который создается по умолчанию. Этот resource pool нельзя удалить, он всегда существует в системе.

Если `CONCURRENT_QUERY_LIMIT` установить в значение `0`, то все запросы отправленные в этот пул будут завершены незамедлительно со статусом `PRECONDITION_FAILED`

## Разрешения

Требуется разрешение `CREATE TABLE` на директорию `.metadata/workload_manager/pools`

## Примеры {#примеры}

```sql
CREATE RESOURCE POOL olap WITH (
    CONCURRENT_QUERY_LIMIT=20,
    QUEUE_SIZE=1000,
    DATABASE_LOAD_CPU_THRESHOLD=80,
    RESOURCE_WEIGHT=100,
    QUERY_MEMORY_LIMIT_PERCENT_PER_NODE=80,
    TOTAL_CPU_LIMIT_PERCENT_PER_NODE=70
)
```

В примере выше создается resource pool в котором есть ограничение на максимальное число параллельных запросов `20`, максимальный размер очереди ожидания `1000`. В случае достижения загрузки базы данных `80` процентов запросы перестают запускаться параллельно. Каждый запрос в пуле может потребить не больше `80` процентов доступной памяти на ноде, при достижении лимита потребления памяти запрос будет завершен со статусом `OVERLOADED`. Общее ограничение доступного CPU для всех запросов в resource pool на ноде составляет `70` процентов. Этот пул имеет вес 100 и он начинает работать только в случае переподписки.

## См. также

* [ALTER RESOURCE POOL](alter-resource-pool.md)
* [DROP RESOURCE POOL](drop-resource-pool.md)